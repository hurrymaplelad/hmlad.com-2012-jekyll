<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Hurry Maple Lad]]></title>
  <link href="http://hurrymaplelad.com/atom.xml" rel="self"/>
  <link href="http://hurrymaplelad.com/"/>
  <updated>2013-04-02T22:52:59-07:00</updated>
  <id>http://hurrymaplelad.com/</id>
  <author>
    <name><![CDATA[Adam Hull]]></name>
    
  </author>

  
  <entry>
    <title type="html"><![CDATA[Ids in Mongoose, JSON, and Backbone]]></title>
    <link href="http://hurrymaplelad.com/ids-in-mongoose-json-and-backbone/"/>
    <updated>2013-04-02T21:24:00-07:00</updated>
    <id>http://hurrymaplelad.com/ids-in-mongoose-json-and-backbone</id>
    <content type="html"><![CDATA[<p>Mongoose adds <a href="http://mongoosejs.com/docs/guide.html#id">id sugar</a> on top the default _id document attribute.  Backbone has <a href="http://backbonejs.org/#Model-idAttribute">similar sugar</a>, but the types don&#8217;t line up.  Pushing bits between the two with a customary JSON document adds a third representation.</p>

<p>If you find yourself typing <code>vegetable.id</code> when you really needed <code>new ObjectID(vegetable.toJSON()._id)</code> this fancy chart might help:</p>

<!-- more -->




<table class="ids">
  <tr><th>Mongoose</th><th>id</th><th>_id</th></tr>
  <tr><td><a href="http://mongoosejs.com/docs/api.html#document_Document-id">document</a></td><td>String</td><td>ObjectID</td></tr>
  <tr><td><a href="http://mongoosejs.com/docs/api.html#query_Query-lean">lean document</a></td><td>undefined</td><td>ObjectID</td></tr>
  <tr><td><a href="http://mongoosejs.com/docs/api.html#document_Document-toJSON">document.toJSON()</a></td><td>undefined</td><td>ObjectID</td></tr>

  <tr><th>JSON</th><th>id</th><th>_id</th></tr>
  <tr><td><a href="http://www.json.org/">object</a></td><td>undefined</td><td>String</td></tr>

  <tr><th>Backbone</th><th>id</th><th>_id</th></tr>
  <tr><td><a href="http://backbonejs.org/#Model-id">model</td><td>String</td><td>undefined</td></tr>
  <tr><td><a href="http://backbonejs.org/#Model-get">model.get()</td><td>undefined</td><td>String</td></tr>
</table>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Breakthrough a Day]]></title>
    <link href="http://hurrymaplelad.com/a-breakthrough-a-day/"/>
    <updated>2013-02-18T23:15:00-08:00</updated>
    <id>http://hurrymaplelad.com/a-breakthrough-a-day</id>
    <content type="html"><![CDATA[<blockquote><p>A breakthrough a day keeps the crisis at bay.</p>

<p><cite>E. F. Schumacher<br>
<a href="http://www.goodreads.com/book/show/1117634.Small_Is_Beautiful">Small is Beautiful</a></cite></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Restructuring Assignment in CoffeeScript]]></title>
    <link href="http://hurrymaplelad.com/restructuring-assignment-in-coffeescript/"/>
    <updated>2013-02-12T22:34:00-08:00</updated>
    <id>http://hurrymaplelad.com/restructuring-assignment-in-coffeescript</id>
    <content type="html"><![CDATA[<p>CoffeeScript can save as many keystrokes putting objects together as it can taking them apart. You won’t find this one in the docs.</p>

<!-- more -->


<p>Sure <a href="http://blog.carbonfive.com/2011/09/28/destructuring-assignment-in-coffeescript/">C5 told you all about</a> CoffeeScript’s <a href="http://coffeescript.org/#destructuring">destructing assignment</a> syntax for objects…</p>

<p>How it can reach deep into nested structures</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nv">user = name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span><span class="p">,</span> <span class="nv">address: </span><span class="p">{</span> <span class="nv">city: </span><span class="s">&#39;Anytown&#39;</span><span class="p">,</span> <span class="nv">state:</span>
</span><span class='line'><span class="s">&#39;AL&#39;</span> <span class="p">}</span>
</span><span class='line'><span class="p">{</span> <span class="nv">name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span><span class="p">,</span> <span class="nv">address: </span><span class="p">{</span> <span class="nv">city: </span><span class="s">&#39;Anytown&#39;</span><span class="p">,</span> <span class="nv">state: </span><span class="s">&#39;AL&#39;</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="p">{</span> <span class="nv">address: </span><span class="p">{</span> <span class="nx">city</span><span class="p">,</span> <span class="nx">state</span> <span class="p">}</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">user</span>
</span><span class='line'><span class="p">{</span> <span class="nv">name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span><span class="p">,</span> <span class="nv">address: </span><span class="p">{</span> <span class="nv">city: </span><span class="s">&#39;Anytown&#39;</span><span class="p">,</span> <span class="nv">state: </span><span class="s">&#39;AL&#39;</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nx">city</span>
</span><span class='line'><span class="s">&#39;Anytown&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or pluck apart function arguments</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">displayName = </span><span class="nf">({ name, age }) -&gt;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">, </span><span class="si">#{</span><span class="nx">age</span><span class="si">}</span><span class="s"> year(s) old&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nx">displayName</span> <span class="nv">name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span>
</span><span class='line'><span class="nx">Foo</span><span class="p">,</span> <span class="mi">42</span> <span class="nx">year</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">old</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or even destructure directly to instance attributes</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="k">class</span> <span class="nx">User</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">({ @name, @age }) -&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span> <span class="nv">name: </span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But what does this do?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nv">age = </span><span class="mi">42</span>
</span><span class='line'><span class="mi">42</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nv">user = </span><span class="p">{</span> <span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nx">age</span> <span class="p">}</span>
</span><span class='line'><span class="o">?</span>
</span></code></pre></td></tr></table></div></figure>


<p>My fudge-fingers managed to mash that one unknowingly into my editor one day while attempting to rack up velocity points on the latest story. Instead of hemorrhaging the expected SyntaxError, it evaluated to this beautiful new object</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="p">{</span> <span class="nv">Foo: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I’ve got a handy set syntax</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="mi">2</span> <span class="k">of</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">}</span>
</span><span class='line'><span class="kc">true</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="mi">2</span> <span class="k">of</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="p">}</span>
</span><span class='line'><span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>And with consistent variable naming, breezy data marshaling between some framework actors</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="k">class</span> <span class="nx">User</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">({ @name, @age }) -&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">template = </span><span class="nf">({ user, face }) -&gt;</span>
</span><span class='line'>  <span class="s">&quot;&lt;div&gt;</span><span class="si">#{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">face</span><span class="si">}</span><span class="s">&lt;/div&gt;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nx">UserView</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">({ @user }) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">render: </span><span class="o">-&gt;</span>
</span><span class='line'>    <span class="vi">@html = </span><span class="nx">template</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">@user</span>
</span><span class='line'>      <span class="nv">face: </span><span class="s">&#39;:)&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nv">user = </span><span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span> <span class="nv">name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nv">view = </span><span class="k">new</span> <span class="nx">UserView</span> <span class="p">{</span><span class="nx">user</span><span class="p">}</span>
</span><span class='line'><span class="p">{</span> <span class="nv">user: </span><span class="p">{</span> <span class="nv">name: </span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="nv">age: </span><span class="mi">42</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">coffee</span><span class="o">&gt;</span> <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</span><span class='line'><span class="s">&#39;&lt;div&gt;Foo :)&lt;/div&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Teacup Released]]></title>
    <link href="http://hurrymaplelad.com/teacup-released/"/>
    <updated>2013-01-09T18:04:00-08:00</updated>
    <id>http://hurrymaplelad.com/teacup-released</id>
    <content type="html"><![CDATA[<p><img src="https://raw.github.com/goodeggs/teacup/master/docs/teacup.jpg" alt="Teacup" /></p>

<p>CoffeeScript templating from the Good Eggs labs:</p>

<ul>
<li><a href="http://bytes.goodeggs.com/post/40042760798/teacup-coffeescript-templates-for-developer-happiness">Intro Post</a></li>
<li><a href="http://goodeggs.github.com/teacup/">Homepage</a></li>
<li><a href="http://github.com/goodeggs/teacup/">Source on Github</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Remove a Property from a Mongoose.js Schema]]></title>
    <link href="http://hurrymaplelad.com/removing-a-property-from-a-mongoose-schema/"/>
    <updated>2012-11-03T00:00:00-07:00</updated>
    <id>http://hurrymaplelad.com/removing-a-property-from-a-mongoose-schema</id>
    <content type="html"><![CDATA[<p>This should be simple, but Mongoose really clings to data in existing documents.  I&#8217;ll walk through all the ways I wanted it to work that failed.  We&#8217;ll remove an <code>organic</code> flag from a toy <code>Food</code> model so we can replace it with <a href="http://www.nytimes.com/2012/10/14/opinion/sunday/bittman-my-dream-food-label.html">Bittman&#8217;s dream label</a>.  If you just came for the solution, I arrived at:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Food</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">update</span><span class="p">({},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">$unset</span><span class="o">:</span> <span class="p">{</span><span class="nx">organic</span><span class="o">:</span> <span class="kc">true</span><span class="p">}},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">safe</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<p>Our well-loved <code>Food</code> schema might look something like:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">Food</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Food&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
</span><span class='line'>  <span class="nx">organic</span><span class="o">:</span> <span class="nb">Boolean</span>
</span><span class='line'><span class="p">},</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">strict</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'><span class="p">}));</span>
</span></code></pre></td></tr></table></div></figure>


<p>and it might be populated with documents like organic frozen broccoli:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">broccoli</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Food</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;frozen broccoli&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">organic</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Alright, time to get rid of that <code>organic</code> property.  Adding a property with Mongoose is as easy as declaring it in the schema.  Could removing be just as easy?</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>  var Food = db.model(&#39;Food&#39;, new mongoose.Schema({
</span><span class='line'>    name: {type: String, required: true},
</span><span class='line'><span class="gd">-   organic: Boolean</span>
</span><span class='line'>  }, {
</span><span class='line'>    strict: true
</span><span class='line'>  }));
</span></code></pre></td></tr></table></div></figure>


<p>If we reload our broccoli doc, will mongoose strip out the undeclared properties?  We did tell Mongoose to be <code>strict</code> with our <code>Food</code>…</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Food</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">broccoli</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;organic&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>No.  Too slick.  I suppose it&#8217;s comforting that mongoose isn&#8217;t silently manipulating our docs.  Maybe we just need to re-save <code>broccoli</code>.  Surely mongoose will be <code>strict</code> now…</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">broccoli</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">Food</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">broccoli</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;organic&#39;</span><span class="p">))</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nope.  <a href="http://grokbase.com/t/gg/mongoose-orm/123ya4qp0a/mongoose-removing-an-existing-field-from-a-collection#20120330swrofqtizat6i3kalhvfrusz5a">Mr. Heckmann rationalizes this behavior</a> as</p>

<blockquote><p>Mongoose &#8220;plays nice&#8221; with existing data in the db, not deleting it unless you tell it to.</p></blockquote>

<p>I&#8217;ll have to be more explicit with this broccoli, more meticulous with my cleanup.  I&#8217;ll unset <code>organic</code> directly.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">broccoli</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;organic&#39;</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">);</span>
</span><span class='line'><span class="nx">broccoli</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">Food</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">broccoli</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;organic&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Wow.  Fine.  Now <code>strict</code> decides to help out.</p>

<p>Mongoose isn&#8217;t cooperating.  Time to talk directly to Mongo.  Maybe Mongoose can at least offer me some <a href="http://mongoosejs.com/docs/api.html#model_Model-update">update sugar</a>:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Food</span><span class="p">.</span><span class="nx">update</span><span class="p">({},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">$unset</span><span class="o">:</span> <span class="p">{</span><span class="nx">organic</span><span class="o">:</span> <span class="kc">true</span><span class="p">}},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">safe</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
</span><span class='line'>  <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Food</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">broccoli</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;organic&#39;</span><span class="p">));</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://hurrymaplelad.com/images/yuno.jpg" alt="Y U NO UNSET!?" /></p>

<p>This must be <code>strict</code> still <a href="https://groups.google.com/d/topic/mongoose-orm/ypvL3Fximjc/discussion">keeping us safe</a>.</p>

<p>Okay.  Last chance Mongoose.  Just give me the collection.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Food</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">update</span><span class="p">({},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">$unset</span><span class="o">:</span> <span class="p">{</span><span class="nx">organic</span><span class="o">:</span> <span class="kc">true</span><span class="p">}},</span>
</span><span class='line'>  <span class="p">{</span><span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">safe</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
</span><span class='line'>  <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Food</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">brocolli</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">broccoli</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;organic&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="kc">undefined</span>
</span></code></pre></td></tr></table></div></figure>


<p>Phew.</p>

<p>Here&#8217;s a <a href="https://gist.github.com/4008255">Mocha spec</a> reproducing this frustrating sequence.  How should we make it be better?</p>
]]></content>
  </entry>
  
</feed>
